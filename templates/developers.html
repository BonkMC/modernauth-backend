<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModernAuthentication API Documentation</title>
    <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
<nav class="top-nav">
    <a class="button" href="/">Home</a>
    <a class="button" href="#create-token">Create Token</a>
    <a class="button" href="#auth-status">Auth Status</a>
    <a class="button" href="#is-user">Is User</a>
</nav>

<div class="container">
    <h1>ModernAuthentication API Documentation</h1>
    <p>
        This document provides detailed information on the API endpoints used by the ModernAuthentication Spigot plugin.
        The plugin communicates with the backend authentication service to facilitate a web-based login process for
        Minecraft players. Below you will find an in-depth explanation of each endpoint including request methods,
        headers, payloads, responses, and usage details.
    </p>
    <hr>

    <!-- Endpoint 1: Create Token -->
    <section id="create-token">
        <h2>1. Create Token</h2>
        <p><strong>Endpoint:</strong> <code>/api/createtoken</code></p>
        <p><strong>HTTP Method:</strong> POST</p>
        <h3>Description</h3>
        <p>
            This endpoint is invoked by the Spigot plugin when a player initiates the authentication process. It creates
            a unique authentication token associated with the player's username and the server identifier. Once the
            token is created, it is stored in the backend’s token system and later used to verify that the player has
            successfully authenticated via the web interface.
        </p>
        <h3>Request Headers</h3>
        <ul>
            <li><code>Content-Type: application/json</code> – Indicates that the request payload is in JSON format.</li>
            <li><code>X-Server-Secret: &lt;secret_value&gt;</code> – A secret key that authenticates the request. This
                value must match the secret configured on the backend for the given server.
            </li>
        </ul>
        <h3>Request Body</h3>
        <p>The JSON payload should include the following fields:</p>
        <pre>{
  "server_id": "your-server-id",
  "token": "unique-generated-token",
  "username": "player_username"
}</pre>
        <h3>Response</h3>
        <p>
            The endpoint returns a generic JSON response:
        </p>
        <pre>{
  "message": "If your token is valid, you will see the appropriate behavior."
}</pre>
        <h3>Usage in the Plugin</h3>
        <p>
            When a player starts the authentication flow, the plugin generates a unique token and calls this endpoint. A
            clickable URL (containing the token) is then sent to the player, which directs them to a web-based
            authentication page.
        </p>
    </section>

    <hr>

    <!-- Endpoint 2: Authentication Status -->
    <section id="auth-status">
        <h2>2. Authentication Status</h2>
        <p><strong>Endpoint:</strong> <code>/api/authstatus/&lt;server_id&gt;/&lt;token&gt;</code></p>
        <p><strong>HTTP Method:</strong> GET</p>
        <h3>Description</h3>
        <p>
            This endpoint is used to verify the authentication status of a token. After the token is created and sent to
            the player, the plugin schedules a repeating task to poll this endpoint. It checks whether the player has
            successfully authenticated via the web interface.
        </p>
        <h3>Request Headers</h3>
        <ul>
            <li><code>X-Server-Secret: &lt;secret_value&gt;</code> – Validates the request against the backend
                configuration.
            </li>
        </ul>
        <h3>Response</h3>
        <p>
            The endpoint returns a JSON object indicating the login status:
        </p>
        <pre>{
  "logged_in": true
}</pre>
        <p>or</p>
        <pre>{
  "logged_in": false
}</pre>
        <h3>Usage in the Plugin</h3>
        <p>
            The plugin’s <code>AuthTask</code> periodically sends GET requests to this endpoint. When the response
            indicates <code>"logged_in": true</code>, the plugin forces a login, registers the player if necessary,
            and—if applicable—updates the player's password.
        </p>
    </section>

    <hr>

    <!-- Endpoint 3: User Existence Check -->
    <section id="is-user">
        <h2>3. User Existence Check</h2>
        <p><strong>Endpoint:</strong> <code>/api/isuser/&lt;server_id&gt;/&lt;username&gt;</code></p>
        <p><strong>HTTP Method:</strong> GET</p>
        <h3>Description</h3>
        <p>
            This endpoint determines whether a user is already registered in the backend system for the specified
            server. It is used during the player join event to decide which authentication flow to follow.
        </p>
        <h3>Response</h3>
        <p>
            The API returns a JSON object that shows the user’s existence status:
        </p>
        <pre>{
  "exists": true
}</pre>
        <p>or</p>
        <pre>{
  "exists": false
}</pre>
        <h3>Usage in the Plugin</h3>
        <p>
            When a player connects to the server, the plugin sends a GET request to this endpoint. Based on the
            response, the plugin either proceeds with the normal authentication flow (if the user exists) or delays the
            confirmation message to allow the player to switch to the new authentication system.
        </p>
    </section>

    <hr>
    <footer class="footer">
        <p>ModernAuthentication API Documentation &copy; 2025 ModernAuthentication Team</p>
    </footer>
</div>
</body>
</html>
